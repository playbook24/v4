<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ORB Board - Éditeur Tactique</title>
    
    <link rel="icon" href="../../logo.png" type="image/png">
    <meta name="theme-color" content="#1a1a1a">
    
    <link href="https://fonts.googleapis.com/css2?family=Anton&family=Montserrat:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../../style.css">
    <link rel="stylesheet" href="board.css">
</head>
<body>

    <header class="app-header">
        <div class="header-content" style="max-width: 100%; padding: 0 20px; display: flex; justify-content: space-between; align-items: center;">
            <div style="display: flex; gap: 15px; align-items: center;">
                <a href="../../index.html" class="btn-icon" title="Quitter l'éditeur">
                    <svg viewBox="0 0 24 24" style="width:28px; height:28px; fill:currentColor;"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
                </a>
                <button id="toggle-playbook-manager-btn" class="btn-primary" style="padding: 8px 16px; display: flex; align-items: center; gap: 8px;">
                    <svg viewBox="0 0 24 24" style="width:20px; height:20px; fill:currentColor;"><path d="M19 2H5C3.9 2 3 2.9 3 4V20C3 21.1 3.9 22 5 22H19C20.1 22 21 21.1 21 20V4C21 2.9 20.1 2 19 2M17 18H7V16H17V18M17 14H7V12H17V14M17 10H7V8H17V10Z"/></svg>
                    <span>Fichier / Export</span>
                </button>
            </div>
            
            <h1 style="margin: 0; text-align: center;">ORB <span class="highlight">ÉDITEUR</span></h1>
            <div style="width: 150px;"></div> 
        </div>
    </header>

    <div id="play-manager-modal" class="modal-overlay hidden" style="position:fixed; top:0; left:0; width:100vw; height:100vh; background:rgba(0,0,0,0.8); z-index:9000; display:flex; align-items:center; justify-content:center;">
        <div style="background:var(--color-container); padding:25px; border-radius:12px; width:400px; border:1px solid var(--color-border); box-shadow: 0 10px 40px rgba(0,0,0,0.5);">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px; border-bottom:1px solid var(--color-border); padding-bottom:15px;">
                <h3 style="margin:0; color:var(--color-primary);">Gestion du Schéma</h3>
                <button id="close-play-manager-btn" class="btn-icon danger" style="padding:0;"><svg viewBox="0 0 24 24"><path d="M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z"/></svg></button>
            </div>

            <div class="playbook-group">
                <label style="font-weight:bold; color:var(--color-text); display:block; margin-bottom:8px;">Titre de l'exercice :</label>
                <input type="text" id="play-name-input" placeholder="Ex: Système Cornes..." style="width: 100%; padding: 10px; margin-bottom: 20px; border-radius: 6px; border: 1px solid var(--color-border); background: var(--color-background); color: var(--color-text);">
            </div>
            
            <button id="save-to-library-btn" class="btn-primary" style="width: 100%; padding: 12px; font-size: 1em; margin-bottom:10px;">Enregistrer / Mettre à jour</button>
            <button id="save-as-new-btn" class="btn-primary" style="display:none; width: 100%; padding: 12px; font-size: 1em; margin-bottom:25px; background: transparent; border: 1px solid var(--color-primary); color: var(--color-primary);">Créer une copie (Nouveau)</button>

            <div style="border-top: 1px solid var(--color-border); padding-top: 15px; margin-bottom: 20px;">
                <label style="font-size: 0.9em; opacity: 0.7; display:block; margin-bottom:10px;">Fichiers Bruts (.json)</label>
                <div style="display: flex; gap: 10px;">
                    <input type="file" id="import-file-input" class="hidden" accept=".json">
                    <button id="load-file-btn" style="flex:1; padding:8px; border-radius:6px; background:var(--color-background); border:1px solid var(--color-border); color:var(--color-text); cursor:pointer;">Importer</button>
                    <button id="save-file-btn" style="flex:1; padding:8px; border-radius:6px; background:var(--color-background); border:1px solid var(--color-border); color:var(--color-text); cursor:pointer;">Exporter</button>
                </div>
            </div>

            <div style="border-top: 1px solid var(--color-border); padding-top: 15px;">
                <label style="font-size: 0.9em; opacity: 0.7; margin-bottom: 10px; display: block;">Générer des visuels pour l'équipe</label>
                <div style="display: flex; gap: 10px;">
                    <button id="export-pdf-btn" class="btn-primary" style="flex:1; padding:10px; background:rgba(191,169,141,0.1); border:1px solid var(--color-primary); color:var(--color-primary);">Fiche PDF</button>
                    <button id="export-video-btn" class="btn-primary" style="flex:1; padding:10px;">Vidéo Animée</button>
                </div>
            </div>
        </div>
    </div>

    <div class="board-layout">
        
        <aside class="sidebar">
            <div class="sidebar-section">
                <h2>Propriétés</h2>
                <div id="prop-content">
                    <p id="no-props-message" style="font-style: italic; opacity: 0.5; font-size: 0.9em;">Cliquez sur un joueur ou une ligne pour modifier ses couleurs.</p>

                    <div id="scene-props" class="prop-group hidden">
                        <div class="prop-row"><label>Nom :</label><input type="text" id="scene-name-prop"></div>
                        <div class="prop-row"><label>Durée (s) :</label><input type="number" id="scene-duration-prop" step="0.1" min="0.1" placeholder="Auto"></div>
                    </div>
                    
                    <div id="player-props" class="prop-group hidden">
                        <div class="prop-row"><label>N° / Nom :</label><input type="text" id="player-label-input"></div>
                        <div class="prop-row"><label>Couleur :</label><input type="color" id="player-color-input"></div>
                        <div class="color-palette"></div>
                    </div>
                    
                    <div id="defender-props" class="prop-group hidden">
                        <div class="prop-row"><label>N° / Nom :</label><input type="text" id="defender-label-input"></div>
                        <div class="prop-row"><label>Couleur :</label><input type="color" id="defender-color-input"></div>
                        <div class="color-palette"></div>
                        <div class="prop-row" style="flex-direction: column; align-items: flex-start;"><label>Orientation :</label><input type="range" id="defender-rotation-input" min="0" max="360" step="1" style="width: 100%;"></div>
                    </div>
                    
                    <div id="ball-props" class="prop-group hidden">
                        <div class="prop-row"><label>Couleur :</label><input type="color" id="ball-color-input"></div>
                    </div>
                    
                    <div id="cone-props" class="prop-group hidden">
                        <div class="prop-row"><label>Couleur :</label><input type="color" id="cone-color-input"></div><div class="color-palette"></div>
                    </div>
                    <div id="hoop-props" class="prop-group hidden">
                        <div class="prop-row"><label>Couleur :</label><input type="color" id="hoop-color-input"></div><div class="color-palette"></div>
                    </div>
                    <div id="basket-props" class="prop-group hidden">
                        <div class="prop-row"><label>Couleur :</label><input type="color" id="basket-color-input"></div><div class="color-palette"></div>
                    </div>
                    <div id="zone-props" class="prop-group hidden">
                        <div class="prop-row"><label>Couleur :</label><input type="color" id="zone-color-input"></div><div class="color-palette"></div>
                    </div>
                    
                    <div id="text-props" class="prop-group hidden">
                        <div class="prop-row"><label>Texte :</label><input type="text" id="text-content-input"></div>
                        <div class="prop-row"><label>Couleur :</label><input type="color" id="text-color-input"></div>
                        <div class="color-palette"></div>
                        <div class="prop-row" style="flex-direction: column; align-items: flex-start;"><label>Taille :</label><input type="range" id="text-size-input" min="8" max="48" step="1" style="width: 100%;"></div>
                    </div>
                    
                    <div id="path-props" class="prop-group hidden">
                        <div class="prop-row"><label>Couleur :</label><input type="color" id="path-color-input"></div>
                        <div class="color-palette"></div>
                        <div class="prop-row" style="flex-direction: column; align-items: flex-start;"><label>Épaisseur :</label><input type="range" id="path-width-input" min="1" max="10" step="0.5" style="width: 100%;"></div>
                    </div>
                </div>
            </div>
            
            <div class="sidebar-section">
                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom: 15px;">
                    <h2 style="margin: 0;">Séquence</h2>
                    <button id="play-animation-btn" title="Lancer l'animation" style="background:var(--color-primary); color:#000; border:none; border-radius:50%; width:32px; height:32px; cursor:pointer; display:flex; align-items:center; justify-content:center;">
                        <svg viewBox="0 0 24 24" style="width:18px; height:18px; fill:currentColor; margin-left:2px;"><path d="M8,5.14V19.14L19,12.14L8,5.14Z" /></svg>
                    </button>
                </div>
                
                <div id="scene-controls" style="display:flex; gap:8px; margin-bottom:15px;">
                    <button id="add-scene-btn" class="sidebar-btn">Dupliquer</button>
                    <button id="animate-scene-btn" class="sidebar-btn" style="color:var(--color-primary); border-color:var(--color-primary);">Animer ➔</button>
                    <button id="delete-scene-btn" title="Supprimer la scène" class="sidebar-btn danger">X</button>
                </div>
                <ul id="scene-list" class="scene-list-style"></ul>
            </div>
            
            <div class="sidebar-section" style="border-bottom: none;">
                <h2>Notes PDF</h2>
                <textarea id="comments-textarea" placeholder="Ex: Consignes, points d'attention..." class="sidebar-textarea"></textarea>
            </div>
        </aside>

        <main class="workspace">
            <div class="toolbar-wrapper">
                <div id="toolbar" class="premium-toolbar">
                     <div class="tool-group">
                        <button id="tool-select" class="tool-btn active" title="Déplacer / Sélectionner (V)"><svg viewBox="0 0 24 24"><path d="M13.62,19.33L12.1,22.45L10.59,19.33L7.47,17.82L10.59,16.3L12.1,13.18L13.62,16.3L16.74,17.82L13.62,19.33M5.5,3L4,6.5L7.5,8L4,9.5L5.5,13L9,11.5L12.5,13L11,9.5L14.5,8L11,6.5L9,3L5.5,3Z" /></svg></button>
                     </div>
                     <div class="tool-group">
                        <button id="tool-player" class="tool-btn" title="Attaquant (O)"><svg viewBox="0 0 24 24"><path d="M12,4A4,4 0 0,1 16,8A4,4 0 0,1 12,12A4,4 0 0,1 8,8A4,4 0 0,1 12,4M12,14C16.42,14 20,15.79 20,18V20H4V18C4,15.79 7.58,14 12,14Z" /></svg></button>
                        <button id="tool-defender" class="tool-btn" title="Défenseur (X)"><svg viewBox="0 0 24 24"><path d="M12,1.75A6.25,6.25 0 0,0 5.75,8C5.75,10.87 7.91,13.28 10.7,13.84V16.2L7.2,17.6C6.7,17.8 6.5,18.4 6.7,18.9L7.6,20.8C7.8,21.3 8.4,21.5 8.9,21.3L12,20L15.1,21.3C15.6,21.5 16.2,21.3 16.4,20.8L17.3,18.9C17.5,18.4 17.3,17.8 16.8,17.6L13.3,16.2V13.84C16.09,13.28 18.25,10.87 18.25,8A6.25,6.25 0 0,0 12,1.75Z"/></svg></button>
                        <button id="tool-ball" class="tool-btn" title="Ballon (B)"><svg viewBox="0 0 24 24"><path d="M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M4.3,15.24L9.5,13.2L11,18.05L5.82,20.07C4.94,18.6 4.3,16.97 4.3,15.24M18.18,20.07L13,18.05L14.5,13.2L19.7,15.24C19.7,16.97 19.06,18.6 18.18,20.07M19.93,8.93L15.5,10.8L14.1,5.5C15.86,5.88 17.39,6.94 18.5,8.32C19.03,8.44 19.5,8.65 19.93,8.93M9.9,5.5L8.5,10.8L4.07,8.93C4.5,8.65 4.97,8.44 5.5,8.32C6.61,6.94 8.14,5.88 9.9,5.5M12,6.34C10.73,7.3 10.2,8.89 10.5,10.3L12,15L13.5,10.3C13.8,8.89 13.27,7.3 12,6.34Z" /></svg></button>
                        <button id="tool-cone" class="tool-btn" title="Plot"><svg viewBox="0 0 24 24"><path d="M12,2L2,22H22L12,2M12,6.5L17.5,17H6.5L12,6.5Z" /></svg></button>
                        <button id="tool-hoop" class="tool-btn" title="Cerceau"><svg viewBox="0 0 24 24"><path d="M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M12,20A8,8 0 0,1 4,12A8,8 0 0,1 12,4A8,8 0 0,1 20,12A8,8 0 0,1 12,20Z" fill="none" stroke="currentColor" stroke-width="2"/></svg></button>
                        <button id="tool-basket" class="tool-btn" title="Panier"><svg viewBox="0 0 24 24"><path d="M5,6H19A1,1 0 0,1 19,8H5A1,1 0 0,1 5,6M7,9L10,18H14L17,9H7Z" /></svg></button>
                        <button id="tool-text" class="tool-btn" title="Texte"><svg viewBox="0 0 24 24"><path d="M5,4V7H10.5V19H13.5V7H19V4H5Z" /></svg></button>
                     </div>
                     <div class="tool-group">
                        <button id="tool-arrow" class="tool-btn" title="Course"><svg viewBox="0 0 24 24"><path d="M4 12L20 12L16 8M20 12L16 16" stroke="currentColor" stroke-width="2" stroke-linecap="round" fill="none"/></svg></button>
                        <button id="tool-pass" class="tool-btn" title="Passe"><svg viewBox="0 0 24 24"><path d="M4 12L20 12L16 8M20 12L16 16" stroke="currentColor" stroke-width="2" stroke-linecap="round" fill="none" stroke-dasharray="4 4"/></svg></button>
                        <button id="tool-dribble" class="tool-btn" title="Dribble"><svg viewBox="0 0 24 24"><path d="M4 18 Q 8 13, 12 18 T 20 18 M17 15l4-3l-4-3" stroke="currentColor" stroke-width="2" stroke-linecap="round" fill="none"/></svg></button>
                        <button id="tool-screen" class="tool-btn" title="Écran"><svg viewBox="0 0 24 24"><path d="M4 12H18M18 8V16" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" fill="none"/></svg></button>
                        <button id="tool-pencil" class="tool-btn" title="Crayon Libre"><svg viewBox="0 0 24 24"><path d="M14.06,9L15,9.94L5.92,19H5V18.08L14.06,9M17.66,3C17.41,3 17.15,3.1 16.96,3.29L15.13,5.12L18.88,8.87L20.71,7.04C21.1,6.65 21.1,6 20.71,5.63L18.37,3.29C18.17,3.09 17.92,3 17.66,3M14.06,6.19L3,17.25V21H6.75L17.81,9.94L14.06,6.19Z"/></svg></button>
                        <button id="tool-zone" class="tool-btn" title="Zone"><svg viewBox="0 0 24 24" fill-opacity="0.4"><path d="M2,2H22V22H2V2M4,4V20H20V4H4Z" /></svg></button>
                     </div>
                     <div class="tool-group">
                        <button id="view-full-court-btn" class="tool-btn view-btn active" title="Terrain Entier"><svg viewBox="0 0 24 24"><rect x="3" y="6" width="18" height="12" stroke="currentColor" stroke-width="2" fill="none"/><line x1="12" y1="6" x2="12" y2="18" stroke="currentColor" stroke-width="1.5"/></svg></button>
                        <button id="view-half-court-btn" class="tool-btn view-btn" title="Demi-Terrain"><svg viewBox="0 0 24 24"><path d="M12 6V18H3V6H12M12 6C12 9.31 9.31 12 6 12C9.31 12 12 14.69 12 18" stroke="currentColor" stroke-width="2" fill="none"/></svg></button>
                        <button id="input-mode-btn" class="tool-btn" title="Changer l'outil de saisie">
                            <svg id="icon-mode-mouse" viewBox="0 0 24 24"><path d="M13,1.07V9H20C20,4.61 16.43,1.07 13,1.07M13,11V19H20C20,14.61 16.43,11 13,11M11,19V11H4C4,14.61 7.57,19 11,19M11,9V1.07C7.57,1.07 4,4.61 11,9Z" /></svg>
                            <svg id="icon-mode-stylus" class="hidden" viewBox="0 0 24 24"><path d="M20.71,7.04C21.1,6.65 21.1,6 20.71,5.63L18.37,3.29C17.98,2.9 17.35,2.9 16.96,3.29L15.13,5.12L18.88,8.87M3,17.25V21H6.75L17.81,9.94L14.06,6.19L3,17.25Z" /></svg>
                        </button>
                     </div>
                     <div class="tool-group" style="border-right: none; padding-right: 0;">
                        <button id="action-undo" class="tool-btn" title="Annuler l'action (Ctrl+Z)"><svg viewBox="0 0 24 24"><path d="M12.5,8C9.85,8 7.45,9 5.6,10.6L2,7V16H11L7.38,12.38C8.77,11.22 10.54,10.5 12.5,10.5C16.04,10.5 19.05,12.81 20.1,16L22.47,15.22C21.08,11.03 17.15,8 12.5,8Z"/></svg></button>
                        <button id="action-redo" class="tool-btn" title="Rétablir l'action (Ctrl+Y)"><svg viewBox="0 0 24 24"><path d="M18.4,10.6C16.55,9 14.15,8 11.5,8C7.85,8 4.92,11.03 3.53,15.22L1,16C2.95,12.81 5.96,10.5 9.5,10.5C11.46,10.5 13.23,11.22 14.62,12.38L11,16H20V7L18.4,10.6Z"/></svg></button>
                        <button id="action-mirror" class="tool-btn" title="Miroir Horizontal (Inverser le schéma)"><svg viewBox="0 0 24 24"><path d="M12,4L8,8H11V16H8L12,20L16,16H13V8H16L12,4M2,12H4V14H2V12M6,12H8V14H6V12M18,12H20V14H18V12M22,12H24V14H22V12Z"/></svg></button>
                        <button id="tool-clear" class="tool-btn danger" title="Effacer"><svg viewBox="0 0 24 24"><path d="M19,4H15.5L14.5,3H9.5L8.5,4H5V6H19M6,19A2 2 0 0,0 8,21H16A2 2 0 0,0 18,19V7H6V19Z"/></svg></button>
                     </div>
                </div>
            </div>

            <div class="artboard-container">
                <div id="court-container">
                    <div id="court-background-container">
                        <svg id="court-svg" class="court" viewBox="0 0 280 150" xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="none">
                            <rect x="0" y="0" width="280" height="150" fill="#BFA98D"/>
                            <g stroke="#212121" stroke-width="0.6" fill="none"><rect x="0" y="0" width="280" height="150"/><line x1="140" y1="0" x2="140" y2="150"/><rect x="0" y="50.5" width="58" height="49" /><path d="M 58 50.5 A 18 18 0 0 1 58 99.5" /><path d="M 0 6 L 29.1 6 A 67.5 67.5 0 0 1 29.1 144 L 0 144" /><rect x="222" y="50.5" width="58" height="49" /><path d="M 222 50.5 A 18 18 0 0 0 222 99.5" /><path d="M 280 6 L 250.9 6 A 67.5 67.5 0 0 0 250.9 144 L 280 144" /></g>
                            <g class="center-court-logo">
                            <circle cx="140" cy="75" r="18" fill="#BFA98D" />
                            <circle cx="140" cy="75" r="18" fill="none" stroke="#212121" stroke-width="0.6"/>
                            <text x="140" y="76" font-family="Impact, 'Arial Black', sans-serif" font-size="15" fill="#212121" text-anchor="middle" dominant-baseline="middle" letter-spacing="0.5">ORB</text>
                            </g>
                            <g stroke="#212121" fill="none"><g transform="translate(15.75, 75)"><line x1="-3.75" y1="-9" x2="-3.75" y2="9" stroke-width="0.8"/><circle cx="0" cy="0" r="2.25" stroke-width="0.5"/><path d="M 0 -12.5 A 12.5 12.5 0 0 1 0 12.5" stroke-width="0.6"/></g><g transform="translate(264.25, 75)"><line x1="3.75" y1="-9" x2="3.75" y2="9" stroke-width="0.8"/><circle cx="0" cy="0" r="2.25" stroke-width="0.5"/><path d="M 0 -12.5 A 12.5 12.5 0 0 0 0 12.5" stroke-width="0.6"/></g></g>
                        </svg>
                    </div>
                    <canvas id="basketball-court"></canvas>
                </div>
            </div>
        </main>
    </div>

    <div id="animation-player" class="hidden" style="position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: rgba(0,0,0,0.95); z-index: 9999; display: flex; flex-direction: column; align-items: center; justify-content: center;">
        <div id="animation-container" style="position: relative; width: 90%; max-width: 1000px; aspect-ratio: 280 / 150; box-shadow: 0 10px 40px rgba(0,0,0,0.8); border: 2px solid var(--color-primary); border-radius:8px; overflow:hidden;">
            <div id="animation-court-background" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%;"></div>
            <canvas id="animation-canvas" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 2; pointer-events: none;"></canvas>
        </div>
        <div id="animation-controls" style="margin-top: 30px; display: flex; align-items: center; gap: 30px; background: var(--color-container); padding: 15px 30px; border-radius: 30px; border: 1px solid var(--color-border);">
            <button id="anim-play-pause-btn" title="Play/Pause" style="background: transparent; border: none; cursor: pointer; color:var(--color-primary);">
                <svg id="anim-icon-play" viewBox="0 0 24 24" style="width:40px; fill:currentColor;"><path d="M8,5.14V19.14L19,12.14L8,5.14Z" /></svg>
                <svg id="anim-icon-pause" class="hidden" viewBox="0 0 24 24" style="width:40px; fill:currentColor;"><path d="M14,19H18V5H14M6,19H10V5H6V19Z" /></svg>
            </button>
            <span id="anim-time-display" style="color: var(--color-text); font-family: monospace; font-size: 1.4em; min-width: 120px; text-align:center;">0.0s / 0.0s</span>
            <button id="anim-close-btn" title="Fermer" style="background: transparent; border: none; cursor: pointer; color:var(--color-primary);">
                <svg viewBox="0 0 24 24" style="width:36px; fill:currentColor;"><path d="M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z"/></svg>
            </button>
        </div>
    </div>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://unpkg.com/ccapture.js@1.1.0/build/CCapture.all.min.js"></script>
    
    <script src="../../core/db.js"></script>
    <script src="../../core/state.js"></script>
    <script src="../../core/utils.js"></script>
    
    <script src="renderer.js"></script>
    <script src="interaction.js"></script>
    <script src="animation.js"></script>
    <script src="ui.js"></script>
    <script src="board.js"></script>

</body>
</html>