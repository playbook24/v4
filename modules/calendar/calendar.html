<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ORB - Calendrier</title>
    <link href="https://fonts.googleapis.com/css2?family=Anton&family=Montserrat:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../../style.css">
    <link rel="stylesheet" href="calendar.css">
</head>
<body>
    <header class="app-header">
        <div class="header-content" style="display: flex; align-items: center; max-width: 1200px; margin: 0 auto; width: 100%;">
            <a href="../../index.html" class="btn-icon" title="Retour au Dashboard">
                <svg viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
            </a>
            <h1 style="margin: 0; text-align: center; flex-grow: 1; padding-right: 40px;">ORB <span class="highlight">CALENDRIER</span></h1>
        </div>
    </header>

    <main style="max-width: 1200px; margin: 30px auto; padding: 0 20px;">
        <div class="calendar-controls">
            <button id="cal-today-btn" class="btn-icon" title="Revenir à aujourd'hui">
                <svg viewBox="0 0 24 24"><path d="M19,19H5V8H19M16,1V3H8V1H6V3H5C3.89,3 3,3.89 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V5C21,3.89 20.1,3 19,3H18V1M17,12H12V17H17V12Z"/></svg>
            </button>
            <div style="display: flex; align-items: center; gap: 20px;">
                <button id="cal-prev-btn" class="btn-primary" style="padding: 8px 15px;">&lt;</button>
                <h3 id="cal-month-display" style="margin: 0; min-width: 180px; text-align: center; color: var(--color-text);">Mois Année</h3>
                <button id="cal-next-btn" class="btn-primary" style="padding: 8px 15px;">&gt;</button>
            </div>
        </div>
        
        <div id="calendar-grid"></div>
    </main>

    <div id="event-editor-modal" class="modal hidden">
         <div class="modal-content">
             <header style="display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid var(--color-border); padding-bottom: 15px; margin-bottom: 20px;">
                 <h3 style="margin: 0; color: var(--color-primary);">Détails de l'événement</h3>
                 <button id="event-modal-close-btn" class="btn-icon danger"><svg viewBox="0 0 24 24"><path d="M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z"/></svg></button>
             </header>

             <div>
                 <input type="hidden" id="event-id">
                 <input type="hidden" id="event-date-str">
                 
                 <div class="form-group">
                    <label>Date : <span id="event-date-display" style="font-weight: normal; color: var(--color-text);"></span></label>
                 </div>
                 
                 <div class="form-group">
                    <label>Équipe concernée</label>
                    <select id="event-team-select" style="background:var(--color-background); color:var(--color-text); border:1px solid var(--color-border); padding:10px; width:100%; border-radius:6px;"></select>
                 </div>

                 <div class="form-group">
                    <label>Titre de la séance</label>
                    <input type="text" id="event-title" placeholder="Ex: Entraînement U15" style="background:var(--color-background); color:var(--color-text); border:1px solid var(--color-border); padding:10px; width:100%; border-radius:6px;">
                 </div>

                 <div id="event-repeat-container" class="form-group" style="display: flex; gap: 15px; align-items: center; background: rgba(255,255,255,0.02); padding: 15px; border-radius: 8px; border: 1px dashed var(--color-primary); margin-bottom: 15px;">
                     <label style="margin:0; flex-grow:1; display:flex; align-items:center; gap:10px; cursor:pointer;">
                         <input type="checkbox" id="event-repeat-checkbox" style="width:18px; height:18px; accent-color:var(--color-primary);">
                         Répéter toutes les semaines jusqu'au :
                     </label>
                     <input type="date" id="event-repeat-until" style="background:var(--color-background); color:var(--color-text); border:1px solid var(--color-border); padding:8px; border-radius:6px;" disabled>
                 </div>

                 <div class="form-group">
                    <label>Plan associé</label>
                    <div id="event-plan-empty">
                        <p style="font-style:italic; opacity:0.5; margin: 0 0 10px 0;">Aucune séance liée.</p>
                        <button id="btn-open-plan-picker" class="btn-primary" style="width:100%">Lier un entraînement</button>
                    </div>
                    <div id="event-plan-selected" class="hidden" style="border:1px solid var(--color-border); padding:15px; border-radius:8px; background: rgba(255,255,255,0.02);">
                         <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
                             <strong><span id="snapshot-plan-name" style="color: var(--color-primary);">Nom du plan</span></strong>
                             <button id="btn-remove-snapshot" style="background:transparent; border:none; color:var(--color-primary); cursor:pointer; text-decoration:underline;">Détacher</button>
                         </div>
                         <button id="btn-view-snapshot-plan" class="btn-primary" style="width: 100%;">Voir le détail du plan</button>
                    </div>
                 </div>
                 
                 <div class="form-group" style="display:flex; justify-content:space-between; align-items:center; background: rgba(255,255,255,0.02); padding: 10px; border-radius: 8px; border: 1px solid var(--color-border);">
                     <label style="margin:0;">Effectif & Présence</label>
                     <button id="btn-manage-attendance" class="btn-primary">Faire l'appel</button>
                 </div>
                 <div id="attendance-summary" style="font-size:0.9em; opacity:0.6; margin-bottom: 20px; text-align: center;"></div>

                 <div class="form-group">
                     <label>Notes / Feedback (Post-Entraînement)</label>
                     <textarea id="event-notes" placeholder="Comment s'est passée la séance ?" rows="3" style="background:var(--color-background); color:var(--color-text); border:1px solid var(--color-border); padding:10px; width:100%; border-radius:6px;"></textarea>
                 </div>
             </div>

             <footer style="display: flex; justify-content: space-between; border-top: 1px solid var(--color-border); padding-top: 20px; margin-top: 10px;">
                 <button id="btn-delete-event" style="background:transparent; border:1px solid var(--color-primary); color:var(--color-primary); padding:10px 20px; border-radius:6px; cursor:pointer;">Supprimer</button>
                 <button id="btn-save-event" class="btn-primary">Enregistrer</button>
             </footer>
         </div>
    </div>

    <div id="attendance-modal" class="modal hidden">
        <div class="modal-content">
            <header style="display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid var(--color-border); padding-bottom: 15px; margin-bottom: 15px;">
                <h3 style="margin: 0; color: var(--color-primary);">Appel des joueurs</h3>
                <button id="attendance-close-btn" class="btn-icon danger"><svg viewBox="0 0 24 24"><path d="M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z"/></svg></button>
            </header>
            <div id="attendance-list" style="max-height: 50vh; overflow-y: auto; padding-right:10px;"></div>
            <footer style="text-align: right; border-top: 1px solid var(--color-border); padding-top: 15px; margin-top: 15px;">
                <button id="btn-save-attendance" class="btn-primary" style="width: 100%;">Valider l'appel</button>
            </footer>
        </div>
    </div>

    <div id="plan-picker-modal" class="modal hidden">
        <div class="modal-content">
            <header style="display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid var(--color-border); padding-bottom: 15px; margin-bottom: 15px;">
                <h3 style="margin: 0; color: var(--color-primary);">Choisir un plan</h3>
                <button id="plan-picker-close-btn" class="btn-icon danger"><svg viewBox="0 0 24 24"><path d="M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z"/></svg></button>
            </header>
            <div id="plan-picker-list" style="max-height: 60vh; overflow-y: auto;"></div>
        </div>
    </div>

    <div id="snapshot-viewer-modal" class="modal hidden">
        <div class="modal-content large">
            <header style="display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid var(--color-border); padding-bottom: 15px; margin-bottom: 15px;">
                <h3 id="viewer-title" style="margin: 0; color: var(--color-primary);">Détails du Plan</h3>
                <button id="viewer-close-btn" class="btn-icon danger"><svg viewBox="0 0 24 24"><path d="M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z"/></svg></button>
            </header>
            <div id="viewer-list" style="overflow-y: auto; display: flex; flex-direction: column; gap: 15px; max-height: 60vh;"></div>
        </div>
    </div>

    <script src="../../core/db.js"></script>
    <script src="calendar.js"></script>
    <script>
        // Applique les thèmes sur toutes les pages
        if (localStorage.getItem('theme') === 'light') document.body.classList.add('light-mode');
        if (localStorage.getItem('teamMode') === 'crab') document.body.classList.add('crab-mode');
    </script>
</body>
</html>