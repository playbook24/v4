<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ORB - Studio PDF</title>
    <link href="https://fonts.googleapis.com/css2?family=Anton&family=Montserrat:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../../style.css">
    <link rel="stylesheet" href="sheet.css">
    <script>
        if (localStorage.getItem('theme') === 'light') document.documentElement.classList.add('light-mode');
        if (localStorage.getItem('teamMode') === 'crab') document.documentElement.classList.add('crab-mode');
    </script>
</head>
<body>
    <header class="app-header">
        <div class="header-content" style="display: flex; align-items: center; max-width: 100%; padding: 0 20px;">
            <a href="../../index.html" class="btn-icon" title="Quitter le Studio">
                <svg viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
            </a>
            <h1 style="margin: 0; text-align: center; flex-grow: 1;">ORB <span class="highlight">STUDIO PDF</span></h1>
            
            <div id="editor-top-actions" class="hidden" style="display:flex; gap:10px; align-items: center;">
                <button id="btn-back-menu" class="btn-icon" title="Retour au menu principal"><svg viewBox="0 0 24 24"><path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/></svg> <span style="font-size:0.8em; font-family:'Montserrat', sans-serif; font-weight:bold; margin-left:5px;">Menu</span></button>
                <div style="width:1px; height:30px; background:var(--color-border); margin:0 5px;"></div>
                
                <button id="btn-undo" class="btn-icon" title="Annuler (Ctrl+Z)"><svg viewBox="0 0 24 24"><path d="M12.5,8C9.85,8 7.45,9 5.6,10.6L2,7V16H11L7.38,12.38C8.77,11.22 10.54,10.5 12.5,10.5C16.04,10.5 19.05,12.81 20.1,16L22.47,15.22C21.08,11.03 17.15,8 12.5,8Z"/></svg></button>
                <button id="btn-redo" class="btn-icon" title="Rétablir (Ctrl+Y)"><svg viewBox="0 0 24 24"><path d="M18.4,10.6C16.55,9 14.15,8 11.5,8C7.85,8 4.92,11.03 3.53,15.22L1,16C2.95,12.81 5.96,10.5 9.5,10.5C11.46,10.5 13.23,11.22 14.62,12.38L11,16H20V7L18.4,10.6Z"/></svg></button>
                
                <div style="width:1px; height:30px; background:var(--color-border); margin:0 5px;"></div>
                
                <button id="btn-save-sheet" class="btn-primary" style="background:var(--color-container); border:1px solid var(--color-primary); color:var(--color-primary);">Enregistrer</button>
                <button id="btn-add-page" class="btn-primary" style="background:var(--color-container); border:1px solid var(--color-border); color:var(--color-text);">+ Page</button>
                <button id="btn-export-pdf" class="btn-primary">Exporter PDF</button>
            </div>
        </div>
    </header>

    <div id="view-hub" class="view-screen active">
        <div class="dashboard-grid" style="margin-top: 80px;">
            <button id="nav-new-exo" class="nav-card"><svg viewBox="0 0 24 24"><path d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M15.8,11.5L14.3,10L8,16.3V17.8H9.5L15.8,11.5M16.4,10.9C16.6,10.7 16.6,10.3 16.4,10.1L15.6,9.3C15.4,9.1 15,9.1 14.8,9.3L13.8,10.3L15.3,11.8L16.4,10.9Z"/></svg><span>Fiche d'Exercice</span></button>
            <button id="nav-new-plan" class="nav-card"><svg viewBox="0 0 24 24"><path d="M19,19H5V8H19M16,1V3H8V1H6V3H5C3.89,3 3,3.89 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V5C21,3.89 20.1,3 19,3H18V1M17,12H12V17H17V12Z"/></svg><span>Fiche d'Entraînement</span></button>
            <button id="nav-storage" class="nav-card"><svg viewBox="0 0 24 24"><path d="M2,20H22V22H2V20M2,4H22V18H2V4M4,6V16H20V6H4M6,8H8V10H6V8M6,12H8V14H6V12M10,8H18V10H10V8M10,12H18V14H10V12Z"/></svg><span>Modèles Sauvegardés</span></button>
        </div>
    </div>

    <div id="view-select-exo" class="view-screen hidden"><div class="selection-container"><button class="btn-back-hub" onclick="SheetStudio.switchView('hub')">&larr; Retour</button><h2>Sélectionner un Exercice</h2><div id="filter-tags-exo" class="tags-filter-bar"></div><input type="text" id="search-exo" class="search-input" placeholder="Rechercher..."><div id="list-select-exo" class="grid-list"></div></div></div>
    <div id="view-select-plan" class="view-screen hidden"><div class="selection-container"><button class="btn-back-hub" onclick="SheetStudio.switchView('hub')">&larr; Retour</button><h2>Sélectionner un Entraînement</h2><div id="list-select-plan" class="grid-list"></div></div></div>
    
    <div id="view-storage" class="view-screen hidden">
        <div class="selection-container">
            <button class="btn-back-hub" onclick="SheetStudio.switchView('hub')">&larr; Retour</button>
            <div style="display:flex; gap:20px; align-items:flex-start;">
                <div style="flex:2;">
                    <h2>Vos Fiches PDF</h2>
                    <div id="filter-tags-storage" class="tags-filter-bar"></div>
                    <div id="list-storage" class="storage-list"></div>
                </div>
                <div style="flex:1; background:var(--color-container); border:1px solid var(--color-border); border-radius:12px; padding:20px;">
                    <h3 style="margin-top:0; color:var(--color-primary);">Gestion des Tags</h3>
                    <div style="display:flex; gap:5px; margin-bottom:15px;">
                        <input type="text" id="storage-new-tag-input" placeholder="Nouveau tag..." style="flex:1; padding:8px; border-radius:6px; background:var(--color-background); color:white; border:1px solid var(--color-border);">
                        <button id="btn-storage-add-tag" class="btn-primary" style="padding:8px 12px;">Créer</button>
                    </div>
                    <div id="storage-tags-manager-list" style="display:flex; flex-direction:column; gap:8px;"></div>
                </div>
            </div>
        </div>
    </div>

    <div id="view-editor" class="view-screen hidden studio-layout">
        <aside class="studio-sidebar">
            <div class="sidebar-section sidebar-tools-section">
                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:8px;">
                    <h4 style="margin:0; color:var(--color-primary); font-family:'Anton'; letter-spacing:1px; font-size: 1.1em;">OUTILS TEXTE</h4>
                    
                    <button id="btn-add-text" class="studio-tool-btn" style="width:auto; padding: 4px 10px; font-size:0.85em; background:rgba(191, 169, 141, 0.15); border-color:var(--color-primary);">
                        <svg viewBox="0 0 24 24" style="width:14px; height:14px; margin-right:4px;"><path d="M9,4V7H11V19H13V7H15V4H9M18.5,11L15.5,18H17.5L18,16.8H21L18.5,11Z"/></svg>
                        Nouveau
                    </button>
                </div>
                
                <div style="display: grid; grid-template-columns: repeat(6, 1fr); gap: 4px;">
                    <button id="btn-text-larger" class="studio-tool-btn mini" title="Agrandir">A+</button>
                    <button id="btn-text-smaller" class="studio-tool-btn mini" title="Réduire">A-</button>
                    <button id="btn-text-bold" class="studio-tool-btn mini" title="Gras"><strong>B</strong></button>
                    <button id="btn-text-align-left" class="studio-tool-btn mini" title="Aligner à gauche"><svg viewBox="0 0 24 24"><path d="M3,3H21V5H3V3M3,7H15V9H3V7M3,11H21V13H3V11M3,15H15V17H3V15M3,19H21V21H3V19Z"/></svg></button>
                    <button id="btn-text-align-center" class="studio-tool-btn mini" title="Centrer"><svg viewBox="0 0 24 24"><path d="M3,3H21V5H3V3M7,7H17V9H7V7M3,11H21V13H3V11M7,15H17V17H7V15M3,19H21V21H3V19Z"/></svg></button>
                    <button id="btn-text-toggle-border" class="studio-tool-btn mini" title="Masquer l'encadré">▢</button>
                </div>
            </div>

            <div id="sidebar-plan-list" class="sidebar-section hidden" style="flex-grow: 1; overflow-y: auto;">
                <h4 style="margin-top:0; color:var(--color-primary);">Exercices de la séance</h4>
                <div id="plan-exos-container" style="display:flex; flex-direction:column; gap:10px;"></div>
            </div>

            <div id="sidebar-exo-detail" class="sidebar-section hidden" style="flex-grow: 1; display: flex; flex-direction: column; overflow:hidden;">
                <button id="btn-back-to-plan" class="studio-tool-btn hidden" style="margin-bottom: 10px; padding: 6px;">&larr; Retour aux exercices</button>
                <h4 id="active-exo-title" style="margin-top:0; margin-bottom:10px; color:var(--color-primary);">Nom de l'exo</h4>
                <button id="btn-add-all-scenes" class="btn-primary" style="width:100%; margin-bottom:15px; padding: 8px;">Tout placer sur la page</button>
                
                <div id="exo-scenes-gallery" class="playbook-gallery-list"></div>
            </div>
        </aside>
        <main class="studio-workspace" id="workspace"><div id="pages-container"></div></main>
    </div>

    <div id="save-sheet-modal" class="modal-overlay hidden" style="position:fixed; top:0; left:0; width:100vw; height:100vh; background:rgba(0,0,0,0.8); z-index:9000; display:flex; align-items:center; justify-content:center;">
        <div style="background:var(--color-container); padding:25px; border-radius:12px; width:450px; border:1px solid var(--color-border);">
            <h3 style="margin-top:0; color:var(--color-primary);">Sauvegarder ce Modèle</h3>
            <input type="text" id="sheet-name-input" placeholder="Nom de la Fiche" style="width:100%; margin-bottom:15px;">
            <p style="margin:0 0 10px 0; font-weight:bold;">Assigner des Tags :</p>
            <div style="display:flex; gap:10px; margin-bottom:15px;">
                <input type="text" id="new-sheet-tag-input" placeholder="Nouveau Tag..." style="flex:1;">
                <button id="btn-add-sheet-tag" class="btn-primary">Créer</button>
            </div>
            <div id="sheet-tags-checkboxes" style="display:flex; flex-direction:column; gap:8px; max-height:150px; overflow-y:auto; margin-bottom:20px; background:var(--color-background); padding:10px; border-radius:6px; border:1px solid var(--color-border);"></div>
            <div style="display:flex; gap:10px;">
                <button id="cancel-save-sheet" class="danger" style="flex:1; cursor:pointer;">Annuler</button>
                <button id="confirm-save-sheet" class="btn-primary" style="flex:1;">Sauvegarder</button>
            </div>
        </div>
    </div>

    <div id="hidden-render-zone" style="position: absolute; left: -9999px; top: -9999px; width: 560px; height: 300px; visibility: hidden;">
        <div id="court-background-container" style="position: relative; width: 100%; height: 100%; background: #BFA98D;">
            <svg id="court-svg" viewBox="0 0 280 150" xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="none" style="width: 100%; height: 100%; display: block;">
                <rect x="0" y="0" width="280" height="150" fill="var(--color-primary)"/>
                
                <g class="court-lines" stroke="#212121" stroke-width="0.6" fill="none"><rect x="0" y="0" width="280" height="150"/><line x1="140" y1="0" x2="140" y2="150"/><rect x="0" y="50.5" width="58" height="49" /><path d="M 58 50.5 A 18 18 0 0 1 58 99.5" /><path d="M 0 6 L 29.1 6 A 67.5 67.5 0 0 1 29.1 144 L 0 144" /><rect x="222" y="50.5" width="58" height="49" /><path d="M 222 50.5 A 18 18 0 0 0 222 99.5" /><path d="M 280 6 L 250.9 6 A 67.5 67.5 0 0 0 250.9 144 L 280 144" /></g>
                
                <g class="center-court-logo">
                    <circle cx="140" cy="75" r="18" fill="var(--color-primary)" />
                    <circle class="court-lines" cx="140" cy="75" r="18" fill="none" stroke="#212121" stroke-width="0.6"/>
                    <text class="court-text-orb" x="140" y="76" font-family="Impact, 'Arial Black', sans-serif" font-size="15" fill="#212121" text-anchor="middle" dominant-baseline="middle" letter-spacing="0.5">ORB</text>
                    <text class="court-text-crab" x="140" y="76" font-family="Impact, 'Arial Black', sans-serif" font-size="15" fill="#212121" text-anchor="middle" dominant-baseline="middle" letter-spacing="0.5">CRAB</text>
                </g>
                
                <g class="court-lines" stroke="#212121" fill="none"><g transform="translate(15.75, 75)"><line x1="-3.75" y1="-9" x2="-3.75" y2="9" stroke-width="0.8"/><circle cx="0" cy="0" r="2.25" stroke-width="0.5"/><path d="M 0 -12.5 A 12.5 12.5 0 0 1 0 12.5" stroke-width="0.6"/></g><g transform="translate(264.25, 75)"><line x1="3.75" y1="-9" x2="3.75" y2="9" stroke-width="0.8"/><circle cx="0" cy="0" r="2.25" stroke-width="0.5"/><path d="M 0 -12.5 A 12.5 12.5 0 0 0 0 12.5" stroke-width="0.6"/></g></g>
            </svg>
            <canvas id="basketball-court" width="560" height="300" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 2;"></canvas>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="../../core/db.js"></script>
    <script src="../../core/state.js"></script>
    <script src="../../core/utils.js"></script>
    <script src="../board/renderer.js"></script>
    <script src="sheet.js"></script>
    <script>
    // Applique les thèmes sur toutes les pages
        if (localStorage.getItem('theme') === 'light') document.body.classList.add('light-mode');
        if (localStorage.getItem('teamMode') === 'crab') document.body.classList.add('crab-mode');
    </script>
</body>
</html>